<xml>

<!-- You can override the in a "vars" section on your own .hxcpp_config -->
<!-- eg:

<xml>

  <section id="vars">
     <set name="IPHONE_VER" value="2.2.1"/>
     <set name="macos_leopard" value="1"/>
  </section>

  <section id="exes">
     <linker id="dll" if="windows">
        <flag value = "-libpath:e:\VS8\DirectXSDK\Lib\x86"/>
     </linker>
  </section>

</xml>

-->


<set name="DBG" value="-debug" if="debug"/>
<set name="IPHONE_VER" value="2.2.1"/>
<set name="STD_MODULE_LINK" value="dll"/>
<set name="STD_MODULE_LINK" value="static" if="iphoneos"/>
<set name="STD_MODULE_LINK" value="static" if="iphonesim"/>


<set name="LIBEXTRA" value=".iphoneos" if="iphoneos"/>
<set name="LIBEXTRA" value=".iphonesim" if="iphonesim"/>


<set name="ZLIB_DIR" value="runtime/thirdparty/zlib-1.2.3"/>
<set name="PCRE_DIR" value="runtime/thirdparty/pcre-7.8"/>
<set name="GC_DIR" value="thirdparty/gc-7.1"/>
<set name="AO_VERSION" value="1.2"/>

<set name="static" value="1" if="iphoneos"/>
<set name="static" value="1" if="iphonesim"/>

<set name="haxelink" value="exe" unless="static"/>
<set name="haxelink" value="static" if="static"/>


<include name="${HXCPP_CONFIG}" section="vars" if ="HXCPP_CONFIG"/>
<include name="${HOME}/.hxcpp_config.xml" section="vars" unless ="windows" noerror="1"/>
<include name="${USERPROFILE}/.hxcpp_config.xml" section="vars" if ="windows" noerror="1"/>


<!-- You can override the exes an "exe" section on your own .hxcpp_config -->
<!-- You can use replace="1" to change the compiler, or omit to add flags -->

<!-- LINUX TOOLS -------------------------------------->

<compiler id="linux" exe="gcc" if="linux">
  <flag value="-c"/>
  <flag value="-fvisibility=hidden"/>
  <cppflag value="-frtti"/>
  <flag value="-g" if="debug"/>
  <flag value="-O2"/>
  <flag value="-DHX_LINUX"/>
  <flag value="-I${HXCPP}/include"/>
  <objdir value="obj/linux/" unless="debug"/>
  <objdir value="obj/linux-dbg/" if="debug"/>
  <outflag value="-o"/>
  <ext value=".o"/>
</compiler>

<linker id="dll" exe="g++" if="linux">
  <flag value="-shared"/>
  <flag value="-fpic"/>
  <flag value="-fPIC"/>
  <flag value="-W,l--unresolved-symbols=report-all"/>
  <flag value="-debug" if="debug"/>
  <ext value=".dso"/>
  <outflag value="-o "/>
</linker>

<linker id="exe" exe="g++" if="linux">
  <flag value="-debug" if="debug"/>
  <flag value="-rdynamic"/>
  <ext value=""/>
  <outflag value="-o "/>
</linker>


<!-- IPHONE TOOLS -------------------------------------------------->


<compiler id="iPhoneOS" exe="/Developer/Platforms/iPhoneOS.platform/Developer/usr/bin/gcc-4.0" if="iphoneos">
  <flag value="-c"/>
  <cflag value="-x"/>
  <cflag value="c"/>
  <cppflag value="-x"/>
  <cppflag value="c++"/>
  <cppflag value="-fvisibility-inlines-hidden"/>
  <flag value="-g" if="debug"/>
  <flag value="-O2" unless="debug"/>
  <flag value="-arch"/>
  <flag value="armv6"/>
  <flag value="-fmessage-length=0"/>
  <flag value="-pipe"/>
  <flag value="-Wno-trigraphs"/>
  <flag value="-fpascal-strings"/>
  <flag value="-fasm-blocks"/>
  <flag value="-Wreturn-type"/>
  <flag value="-Wunused-variable"/>
  <flag value="-isysroot"/>
  <flag value="/Developer/Platforms/iPhoneOS.platform/Developer/SDKs/iPhoneOS${IPHONE_VER}.sdk"/>
  <flag value="-fvisibility=hidden"/>
  <flag value="-gdwarf-2"/>
  <flag value="-miphoneos-version-min=${IPHONE_VER}"/>
  <flag value="-DIPHONE"/>
  <flag value="-DIPHONEOS"/>
  <flag value="-DSTATIC_LINK"/>
  <flag value="-I${HXCPP}/include"/>
  <cppflag value="-frtti"/>
  <outflag value="-o"/>
  <ext value=".o"/>
  <objdir value="obj/iphoneos/" unless="debug"/>
  <objdir value="obj/iphoneos-dbg/" if="debug"/>
</compiler>

<compiler id="iPhoneSim" exe="/Developer/Platforms/iPhoneSimulator.platform/Developer/usr/bin/gcc-4.0" if="iphonesim">
  <flag value="-c"/>
  <cflag value="-x"/>
  <cflag value="c"/>
  <cppflag value="-x"/>
  <cppflag value="c++"/>
  <cppflag value="-fvisibility-inlines-hidden"/>
  <flag value="-g" if="debug"/>
  <flag value="-O2" unless="debug"/>
  <flag value="-fmessage-length=0"/>
  <flag value="-pipe"/>
  <flag value="-Wno-trigraphs"/>
  <flag value="-fpascal-strings"/>
  <flag value="-fasm-blocks"/>
  <flag value="-Wreturn-type"/>
  <flag value="-Wunused-variable"/>
  <flag value="-arch"/>
  <flag value="i386"/>
  <flag value="-isysroot"/>
  <flag value="/Developer/Platforms/iPhoneSimulator.platform/Developer/SDKs/iPhoneSimulator${IPHONE_VER}.sdk"/>
  <flag value="-fvisibility=hidden"/>
  <flag value="-miphoneos-version-min=${IPHONE_VER}"/>
  <flag value="-DIPHONE"/>
  <flag value="-DIPHONESIM"/>
  <flag value="-DSTATIC_LINK"/>
  <flag value="-I${HXCPP}/include"/>
  <cppflag value="-frtti"/>
  <outflag value="-o"/>
  <ext value=".o"/>
  <objdir value="obj/iphonesim/" unless="debug"/>
  <objdir value="obj/iphonesim-dbg/" if="debug"/>
</compiler>



<compiler id="darwin" exe="gcc" if="macos">
  <flag value="-c"/>
  <flag value="-fvisibility=hidden"/>
  <cppflag value="-c++"/>
  <cppflag value="-frtti"/>
  <flag value="-g" if="debug"/>
  <flag value="-O2" unless="debug"/>
  <flag value="-I${HXCPP}/include"/>
  <flag value="-DHX_MACOS"/>
  <objdir value="obj/darwin/" unless="debug"/>
  <objdir value="obj/darwin-dbg/" if="debug"/>
  <outflag value="-o"/>
  <ext value=".o"/>
</compiler>

<linker id="dll" exe="g++" if="macos">
  <flag value="-fpic"/>
  <flag value="-fPIC"/>
  <flag value="-dynamiclib"/>
  <flag value="-framework"/>
  <flag value="Cocoa"/>
  <flag value="-fvisibility=hidden"/>
  <flag value="-debug" if="debug"/>
  <ext value=".dylib"/>
  <outflag value="-o "/>
</linker>

<linker id="exe" exe="g++" if="macos">
  <flag value="-framework"/>
  <flag value="Cocoa"/>
  <flag value="-debug" if="debug"/>
  <ext value=""/>
  <outflag value="-o "/>
</linker>

<linker id="static" exe="ar" unless="windows">
  <ext value=".a"/>
  <outflag value="-cr "/>
  <ranlib name="ranlib"/>
</linker>

<!-- WINDOWS TOOLS -------------------------------------->

<compiler id="MSVC" exe="cl.exe" if="windows">
  <flag value="-nologo"/>
  <flag value="-Od" if="debug"/>
  <flag value="-O2" unless="debug"/>
  <flag value="-MTd" if="debug"/>
  <flag value="-MT" unless="debug"/>
  <flag value="-DHX_WINDOWS"/>
  <flag value="-GR"/>
  <flag value="-Zi"/>
  <flag value="-c"/>
  <flag value="-EHsc"/>
  <flag value="-I${HXCPP}/include"/>
  <flag value="-D_CRT_SECURE_NO_DEPRECATE"/>
  <flag value="-wd4996"/>
  <outflag value="-Fo"/>
  <ext value=".obj"/>
  <objdir value="obj/Debug" if="debug"/>
  <objdir value="obj/Release" unless="debug"/>
</compiler>

<linker id="dll" exe="link.exe" if="windows">
  <flag value="-nologo"/>
  <flag value="-machine:x86"/>
  <flag value="-dll"/>
  <flag value="-debug" if="debug"/>
  <ext value=".dll"/>
  <libdir name="obj/lib"/>
  <flag value="-libpath:lib"/>
  <fromfile value="@"/>
  <outflag value="-out:"/>
</linker>

<linker id="exe" exe="link.exe" if="windows">
  <fromfile value="@"/>
  <flag value="-nologo"/>
  <flag value="-machine:x86"/>
  <flag value="-debug" if="debug"/>
  <flag value="-libpath:lib"/>
  <flag value="user32.lib"/>
  <ext value=".exe"/>
  <outflag value="-out:"/>
</linker>

<!-- Library files & targets -------------------------------------->


<files id="runtime" dir="${HXCPP}">
  <depend name="${HXCPP}/include/hxMacros.h"/>
  <depend name="${HXCPP}/include/hxObject.h"/>
  <depend name="${HXCPP}/include/hxMath.h"/>

  <compilerflag value="-DBUILDING_HXCPP_DLL"/>
  <compilerflag value="-D_CRT_SECURE_NO_DEPRECATE"/>
  <compilerflag value="-DALL_INTERIOR_POINTERS"/>
  <compilerflag value="-DGC_NOT_DLL"/>

  <compilerflag value="-DHXCPP_DEBUG" if="debug"/>

  <compilerflag value="-DCPU" if="windows"/>
  <compilerflag value="-DMY_CPU" if="windows"/>
  <compilerflag value="-DX86" if="windows"/>
  <compilerflag value="-DWIN32_THREADS" if="windows"/>

  <compilerflag value="-DX86" if="macos"/>
  <compilerflag value="-DHAS_X86_THREAD_STATE32___EAX=1" if="macos" unless="macos_leopard"/>
  <compilerflag value="-DNO_THREAD_REDIRECT" if="macos"/>
  <compilerflag value="-DGC_THREADS" if="macos"/>
  <compilerflag value="-DNO_THREAD_REDIRECT" if="linux"/>
  <compilerflag value="-DGC_THREADS" if="linux"/>

  <compilerflag value="-I${HXCPP}/runtime/${GC_DIR}/include"/>
  <compilerflag value="-I${HXCPP}/runtime/${GC_DIR}/include/private"/>
  <compilerflag value="-I${HXCPP}/runtime/${GC_DIR}/libatomic_ops-${AO_VERSION}/src"/>

  <file name = "runtime/src/hxObject.cpp"/>
  <file name = "runtime/src/hxDate.cpp"/>
  <file name = "runtime/src/hxGC.cpp"/>
  <file name = "runtime/src/hxGCInternal.cpp"/>
  <file name = "runtime/src/hxHash.cpp"/>
  <file name = "runtime/src/hxLib.cpp"/>
  <file name = "runtime/src/hxCFFI.cpp"/>


  <file name="runtime/${GC_DIR}/win32_threads.c" if="windows"/>
  <file name="runtime/${GC_DIR}/darwin_stop_world.c" if="macos"/>
  <file name="runtime/${GC_DIR}/pthread_stop_world.c" unless="windows"/>
  <file name="runtime/${GC_DIR}/pthread_support.c" unless="windows"/>
  <file name="runtime/${GC_DIR}/allchblk.c"/>
  <file name="runtime/${GC_DIR}/alloc.c"/>
  <file name="runtime/${GC_DIR}/backgraph.c"/>
  <file name="runtime/${GC_DIR}/blacklst.c"/>
  <file name="runtime/${GC_DIR}/checksums.c"/>
  <file name="runtime/${GC_DIR}/dbg_mlc.c"/>
  <file name="runtime/${GC_DIR}/dyn_load.c"/>
  <file name="runtime/${GC_DIR}/finalize.c"/>
  <file name="runtime/${GC_DIR}/gc_dlopen.c"/>
  <file name="runtime/${GC_DIR}/gcj_mlc.c"/>
  <file name="runtime/${GC_DIR}/headers.c"/>
  <file name="runtime/${GC_DIR}/mach_dep.c"/>
  <file name="runtime/${GC_DIR}/malloc.c"/>
  <file name="runtime/${GC_DIR}/mallocx.c"/>
  <file name="runtime/${GC_DIR}/mark.c"/>
  <file name="runtime/${GC_DIR}/mark_rts.c"/>
  <file name="runtime/${GC_DIR}/misc.c"/>
  <file name="runtime/${GC_DIR}/msvc_dbg.c" if="windows"/>
  <file name="runtime/${GC_DIR}/new_hblk.c"/>
  <file name="runtime/${GC_DIR}/obj_map.c"/>
  <file name="runtime/${GC_DIR}/os_dep.c"/>
  <file name="runtime/${GC_DIR}/pcr_interface.c"/>
  <file name="runtime/${GC_DIR}/ptr_chck.c"/>
  <file name="runtime/${GC_DIR}/real_malloc.c"/>
  <file name="runtime/${GC_DIR}/reclaim.c"/>
  <file name="runtime/${GC_DIR}/specific.c"/>
  <file name="runtime/${GC_DIR}/stubborn.c"/>
  <file name="runtime/${GC_DIR}/thread_local_alloc.c"/>
  <file name="runtime/${GC_DIR}/typd_mlc.c"/>
</files>

<target id="runtime" output="hxcpp${DBG}" tool="linker" toolid="${STD_MODULE_LINK}">
  <files id="runtime"/>
  <lib name="user32.lib" if="windows"/>
  <lib name="-lpthread" if="linux"/>
  <lib name="-ldl" if="linux"/>
</target>


<target id="std" output="std${DBG}" tool="linker" toolid="${STD_MODULE_LINK}">
  <files id="std"/>
  <flag value="-dll"/>
  <lib name="wsock32.lib" if="windows"/>
  <lib name="-lpthread" if="linux"/>
  <lib name="-ldl" if="linux"/>
</target>


<files id="regexp" dir="${HXCPP}">
  <depend name="${HXCPP}/include/hxMacros.h"/>
  <depend name="${HXCPP}/include/hxObject.h"/>
  <depend name="${HXCPP}/include/neko.h"/>

  <compilerflag value="-DPCRE_STATIC"/>
  <compilerflag value="-I${HXCPP}/${PCRE_DIR}"/>

  <file name="runtime/libs/regexp/RegExp.cpp"/>

  <file name="${PCRE_DIR}/pcre_get.c"/>
  <file name="${PCRE_DIR}/pcre_study.c"/>
  <file name="${PCRE_DIR}/pcre_chartables.c"/>
  <file name="${PCRE_DIR}/pcre_globals.c"/>
  <file name="${PCRE_DIR}/pcre_tables.c"/>
  <file name="${PCRE_DIR}/pcre_compile.c"/>
  <file name="${PCRE_DIR}/pcre_info.c"/>
  <file name="${PCRE_DIR}/pcre_try_flipped.c"/>
  <file name="${PCRE_DIR}/pcre_config.c"/>
  <file name="${PCRE_DIR}/pcre_maketables.c"/>
  <file name="${PCRE_DIR}/pcre_ucd.c"/>
  <file name="${PCRE_DIR}/pcre_dfa_exec.c"/>
  <file name="${PCRE_DIR}/pcre_newline.c"/>
  <file name="${PCRE_DIR}/pcre_valid_utf8.c"/>
  <file name="${PCRE_DIR}/pcre_exec.c"/>
  <file name="${PCRE_DIR}/pcre_ord2utf8.c"/>
  <file name="${PCRE_DIR}/pcre_version.c"/>
  <file name="${PCRE_DIR}/pcre_fullinfo.c"/>
  <file name="${PCRE_DIR}/pcre_refcount.c"/>
  <file name="${PCRE_DIR}/pcre_xclass.c"/>

</files>



<target id="regexp" output="regexp${DBG}" tool="linker" toolid="${STD_MODULE_LINK}">
  <files id="regexp"/>
</target>


<files id="zlib" dir="${HXCPP}">
  <depend name="${HXCPP}/include/hxMacros.h"/>
  <depend name="${HXCPP}/include/hxObject.h"/>
  <depend name="${HXCPP}/include/neko.h"/>

  <compilerflag value="-I${HXCPP}/${ZLIB_DIR}"/>

  <file name="runtime/libs/zlib/ZLib.cpp"/>

  <file name="${ZLIB_DIR}/adler32.c"/>
  <file name="${ZLIB_DIR}/crc32.c"/>
  <file name="${ZLIB_DIR}/infback.c"/>
  <file name="${ZLIB_DIR}/inflate.c"/>
  <file name="${ZLIB_DIR}/uncompr.c"/>
  <file name="${ZLIB_DIR}/compress.c"/>
  <file name="${ZLIB_DIR}/deflate.c"/>
  <file name="${ZLIB_DIR}/gzio.c"/>
  <file name="${ZLIB_DIR}/inffast.c"/>
  <file name="${ZLIB_DIR}/inftrees.c"/>
  <file name="${ZLIB_DIR}/trees.c"/>
  <file name="${ZLIB_DIR}/zutil.c"/>

</files>




<target id="zlib" output="zlib${DBG}" tool="linker" toolid="dll">
  <files id="zlib"/>
</target>


<target id="default">
   <target id="runtime"/>
   <target id="std"/>
   <target id="regexp"/>
   <target id="zlib"/>
</target>


<target id="clean" tool="clean">
  <dir name="obj"/>
</target>


<target id="haxe" tool="linker" toolid="${haxelink}" output="${HAXE_OUTPUT}${DBG}">
  <files id="haxe"/>
  <ext value=".iphoneos.a" if="iphoneos"/>
  <ext value=".iphonesim.a" if="iphonesim"/>
  <files id="__main__" unless="static"/>
  <files id="__lib__" if="static"/>
  <files id="runtime"/>
  <lib name="-lpthread" if="linux"/>
  <lib name="-ldl" if="linux"/>
</target>

<!-- Add user config if provided, "exes" section ------------------>

<include name="${HXCPP_CONFIG}" section="exes" if ="HXCPP_CONFIG"/>
<include name="${HOME}/.hxcpp_config.xml" section="exes" unless ="windows" noerror="1"/>
<include name="${USERPROFILE}/.hxcpp_config.xml" section="exes" if ="windows" noerror="1"/>

</xml>


